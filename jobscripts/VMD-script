
#############################################################
#         VMD procedure to draw the integration planes      #
#           Add the code to the .vimrc file                 #
#    		USAGE: intplanes 8 		 	    #
#	where 8 is the number of opened grid files          #
#############################################################

# When you do current profiles you might want to see them drawn clearly 
# Perform a dry run on the first and last input files, so as to obtain the grid.xyz files for the two ends. 
# Remember to copy the grid.xyz to a backup file, because the next dry run will overwrite it.
# Then you can replace the coordinates of the first two atoms X from one of the grid.xyz file to the other. 
# The atoms X are the corners of the integration plane.
# The resulting grid.xyz file can then be opened in VMD.Â 
# To call the script, click Extensions from the main window and then select Tk Console.

proc intplanes {} {

set loadedMolecules [molinfo list]

foreach molid $loadedMolecules {

    mol showrep $molid 0 off
    mol modselect 0 $molid "all not element X Be"
    set xel [atomselect $molid "element X"]
    set coords [$xel get index]

    for {set i 0} {$i < 4} {incr i} {
         lassign $coords i1 i2 i3 i4
        }

    set c1 [atomselect $molid "index $i1"]
    set c2 [atomselect $molid "index $i2"]
    set c3 [atomselect $molid "index $i3"]
    set c4 [atomselect $molid "index $i4"]

        lassign [$c1 get {x y z}] pos1
        lassign [$c2 get {x y z}] pos2
        lassign [$c3 get {x y z}] pos3
        lassign [$c4 get {x y z}] pos4

        draw color red
		set LINEWIDTH 6
        draw line $pos1 $pos2 width $LINEWIDTH
        draw line $pos3 $pos4 width $LINEWIDTH
        draw line $pos1 $pos3 width $LINEWIDTH
        draw line $pos2 $pos4 width $LINEWIDTH
		
		set posHalf1 [ vecscale 0.5 [ vecadd $pos1 $pos2 ] ]
		set posHalf2 [ vecscale 0.5 [ vecadd $pos3 $pos4 ] ]
		
		set LINEWIDTH 3 
		draw line $posHalf1 $posHalf2 width $LINEWIDTH
}

# CPK: sphere_scale then bond_radius then sphere_resolution then bond_resolution
mol representation CPK 0.600000 0.300000 50.000000 50.000000
mol color Element
mol material Opaque
mol addrep $molid
mol modselect 1 $molid "all not element X Be"
}



